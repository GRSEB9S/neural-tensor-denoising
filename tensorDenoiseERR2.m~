function [ summary ] = tensorDenoiseERR2( Y, Yhat, measure, trialCount )
%TENSORDENOISEERR2 function for mse vs err plots
% trial count is nxc matrix of trial counts



[n,t,c,r] = size(Y);
maxr = 30;
Ysm = mean(Y,4,'omitnan');
errMeasure = 2;

% strategy 1 -- 
for rr = 1:maxr
  rr
  for ii = 1:50
    trial = [];
    Ys = zeros(n,t,c,rr);
    for nn = 1:n
    for cc = 1:c
      trial{nn,cc} = randi(trialCount(nn,cc),rr,1);
      Ys(nn,:,cc,:) = Y(nn,:,cc,trial{nn,cc});
    end
    end
  Ytr = mean(Ys,4,'omitnan');
  [mlRank,~] = tensorDenoiseRankEst( mean(Y,4,'omitnan'), Ytr, 2);
  mse1(rr,ii) = tensorDenoiseERR(Ysm, Ytr, errMeasure);
  for kk = 1:length(mlRank)
    lrModel = tensorDenoiseSVD(Ytr, mlRank{kk});
    mse2{kk}(rr,ii) = tensorDenoiseERR(Ysm, lrModel, errMeasure);
  end
  end  
end
summary.mse1 = mse1;
summary.mse2 = mse2;
end

